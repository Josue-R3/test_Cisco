<!DOCTYPE HTML>
<html>

<head>
   <meta name="keywords" content="Kelowna, Wine, Tours, discount, trails">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" type="text/css" href="css/style.css">
   <style type="text/css">
      html {
         background: url(images/bg_image1.png) no-repeat center center fixed;
         background-size: cover;
         height: 100%;
         /* overflow: hidden; */
      }

      table,
      td {
         border: 1px solid black;
         border-collapse: collapse;
         padding: 10px;
         background-color: #adbf9e;
      }

      .layout {
         border: 0px;
         /*border-collapse: collapse; */
         padding: 10px;
         background-color: inherit;
      }

      h1,
      h2 {
         text-align: center;
      }

      #advice {
         display: none;
      }
   </style>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
   <script>
      /* 
      SCRIPT 
      
      Author: Washington Valencia
      Instructor: Washington Valencia
      
      ENTER STUDENT INFORMATION HERE 
      ==========================================
      CCTB project DevOps course
      STUDENT NAME: JOSUE RUIZ
      STUDENT ID: 1063864366
      SQAC114
      ==========================================
      
      */

      //define constants
      const DAILYRATE = 50;
      //Group 1
      const MINSIZEGRP1 = 5;
      const MAXSIZEGRP1 = 10;
      const DISCGRP1 = 0.10;
      //Group 2
      const MAXSIZEGRP2 = 24;
      const DISCGRP2 = 0.20;
      //Group 3
      const DISCGRP3 = 0.25;

      let wCurrentPos = document.getElementById("bee").style.left;
      let hCurrentPos = document.getElementById("bee").style.top;

      // define initial position
      let wPos = 0;
      let hPos = 0;

      //Size Screen
      let wSize = window.innerWidth;
      let hSize = window.innerHeight;

      //Global variable
      let intID;

      //define the variables for input
      let firstname = document.getElementById("firstname");
      let lastname = document.getElementById("lastname");
      let groupSize = document.getElementById("GroupSize");
      let discRate = document.getElementById("discRate");
      let membersLst = document.getElementById("members");

      //define the variables for buttons
      let addMemberBtn = document.getElementById("addMemberBtn");
      let deleteMemberBtn = document.getElementById("deleteMemberBtn");
      let sortMemberListBtn = document.getElementById("sortMemberListBtn");

      //reference to Bee
      let bee = document.getElementById("bee");

      //reference to advice
      let advice = document.getElementById("advice");

      let ratePerson;

      /*
      * Function to check that a user has entered a group memberâ€™s first and last name.
      * 
      */
      function CheckForGroupMemberInput() {
         if (firstname.value != "") {
            if (lastname.value != "") {
               CheckForGroupSizeInput();
            } else {
               throw "Please first enter a group member's name";
               lastname.focus();
            }
         } else {
            throw "Please first enter a group member's name";
            firstname.focus();
         }
      }

      /*
      * Function to check that a user has entered a value for how many people are in the group and that the entry is numeric.
      * 
      */
      function CheckForGroupSizeInput() {
         if (groupSize.value != "") {
            if (isNaN(groupSize.value)) {
               throw groupSize.value + " is not a number";
               groupSize.focus();
            } else {
               if (groupSize.value > 0) {
                  CalcGroupDiscount(groupSize.value);
               } else {
                  throw "Size must be greater than 0";
                  groupSize.focus();
               }

            }
         } else {
            throw "Please enter the size of your group travelers";
            groupSize.focus();
         }
      }

      /*
      * Function to calculate the applicable discount per group member based on group size. 
      * 
      */
      function CalcGroupDiscount(groupSize) {
         if (groupSize < MINSIZEGRP1) {
            ratePerson = DAILYRATE;
         }
         else if (groupSize >= MINSIZEGRP1 && groupSize <= MAXSIZEGRP1) {
            ratePerson = DAILYRATE - (DAILYRATE * DISCGRP1);
         } else if (groupSize > MAXSIZEGRP1 && groupSize <= MAXSIZEGRP2) {
            ratePerson = DAILYRATE - (DAILYRATE * DISCGRP2);
         } else if (groupSize > MAXSIZEGRP2) {
            ratePerson = DAILYRATE - (DAILYRATE * DISCGRP3);
         }

         discRate.value = ratePerson.toFixed(2);
         AddGroupMember(lastname.value, firstname.value);
      }

      /*
      * Function to add a group member to the selection list.
      * 
      */
      function AddGroupMember(lastName, firstName) {
         if (membersLst.options.length < groupSize.value) {
            let option = document.createElement("option");
            option.text = lastName + ", " + firstName;
            membersLst.add(option);

            lastname.value = "";
            firstname.value = "";

            lastname.focus();
         } else {
            throw "The number of group members cannot exceed the specified group size.";
         }
      }

      /*
      * Function to remove (delete) a selected group member from the selection list.
      * 
      */
      function RemoveGroupMember() {
         if (membersLst.selectedIndex >= 0) {
            membersLst.remove(membersLst.selectedIndex);
         } else {
            throw "Please select a group member to remove!";
         }

         lastname.value = "";
         firstname.value = "";

         lastname.focus();
      }

      /*
      * Function to sort the list of group members in ascending order by last name.
      * 
      */
      function SortGroupMembers() {
         if (membersLst.options.length > 0) {
            var tmpArray = new Array();

            for (let i = 0; i < membersLst.options.length; i++) {
               tmpArray[i] = new Array();
               tmpArray[i][0] = membersLst.options[i].text;
               tmpArray[i][1] = membersLst.options[i].value;
            }
            tmpArray.sort();

            for (var i = 0; i < tmpArray.length; i++) {
               var op = new Option(tmpArray[i][0], tmpArray[i][1]);
               membersLst.options[i] = op;
            }
         } else {
            throw "There are no group members to sort!";
         }
      }

      function FlyingBee() {
         wPos += parseInt(50);
         hPos += parseInt(10);

         if (wPos <= wSize * 0.65 || hPos <= hSize * 0.20) {
            bee.style.left = wPos + "px";
            bee.style.top = hPos + "px";

         } else {
            clearInterval(intID);
            advice.style.display = "block";
         }
      }

      addMemberBtn.addEventListener("click",
         function () {
            try {
               CheckForGroupMemberInput();
            } //end of try BlockList

            //catch block - catch and report the errors
            catch (e) {
               alert(e);
            }
         }
      )

      deleteMemberBtn.addEventListener("click",
         function () {
            try {
               RemoveGroupMember();
            }
            //catch block - catch and report the errors
            catch (e) {
               alert(e);
            }
         });

      bee.addEventListener("load", function () {
         bee.style.visibility = "visible";
         intID = setInterval(FlyingBee, 300);
      })

      sortMemberListBtn.addEventListener("click",
         function () {
            try {
               SortGroupMembers();
            }
            catch (e) {
               alert(e);
            }
         }
      )

      $(document).ready(() => {
         $.getJSON("https://api.ipify.org?format=json",
            function (data) {
               // Displaying IP address on screen
               $("#gfg").html(window.location.hostname);
            })
      });
   </script>
   <title>DevOps Bonus Project - CCTB</title>
</head>

<body>
   <img src="images/bee2.gif" id="bee" style="position: absolute; left: -150; top: 0px; visibility:hidden;" alt="Flying bee" height="179" width="144" />

   <h1> Kelowna Wine Trails and Tours</h1>
   <h3> Josue Ruiz / josue.ruiz@iste.edu.ec </h3>
   <p id="gfg"></p>
   <hr size="1" color="#b6bcbb"> <br />

   <div class="content" align="left">
      <table class="layout">
         <tr>
            <td class="layout">
               <form>
                  <table border="0">
                     <tr valign="center">
                        <td>
                           <h3>Group Discounts</h3>
                           <ul>
                              <li>Daily Rate: $50 per person</li>
                              <li>5-10 people: 10% discount</li>
                              <li>11-24 people: 20% discount</li>
                              <li>25+ people: 25% discount</li>
                           </ul>
                        </td>

                        <td valign="top">
                           <h3> Group Members</h3>
                           <p>
                              <input type="button" class="buttons" id="addMemberBtn" value="Add Member" />
                              <input type="button" class="buttons" id="deleteMemberBtn" value="Delete Member" />
                              <input type="button" class="buttons" id="sortMemberListBtn" value="Sort Member List" />

                           </p>

                           <table border="0">
                              <tr>
                                 <td>
                                    <select name="group" id="members" size="13" style="width: 150px"></select>
                                 </td>

                                 <td valign="top">Last name<br />
                                    <input type="text" name="lastname" id="lastname" size="30" /><br />
                                    First name<br />
                                    <input type="text" name="firstname" id="firstname" size="30" /><br />
                                 </td>
                              </tr>
                           </table>

                           <p>
                              How many people are in your group?
                              <input type="text" name="Group Size" id="GroupSize" size="5" value="0" />
                           </p>
                           <p> Your group rate is $<input type="text" name="Discounted Rate" id="discRate" size="6"
                                 value="" readonly="readonly" class="total" /> per person.</p>
                        </td>
                     </tr>
                  </table>
               </form>
            </td>
            <td class="layout">
               <div align="right"> <span id="advice"><em>Like this bee, be sure to stop <br /> and smell the
                        flowers!</em></span></div>
            </td>
         </tr>
      </table>
   </div>

   <div class="footer" align="center">
      <div style="padding-left: 20px; padding-top: 35px;" class="copy">
         Copyright &copy; 2021. Kelowna Wine Trails and Tours. All rights reserved
      </div>
   </div>

</body>

</html>
